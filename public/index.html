<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🤖 Painel Bot WhatsApp Admin</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .status-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            text-align: center;
        }

        .status-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .status-connected { 
            background: #4CAF50; 
            animation: none;
        }
        .status-disconnected { 
            background: #f44336; 
        }
        .status-qr { 
            background: #ff9800; 
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            color: #444;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }

        .btn-success {
            background: linear-gradient(45deg, #26d0ce, #1dd1a1);
        }

        .btn-warning {
            background: linear-gradient(45deg, #ffa726, #ff9800);
        }

        .qr-code {
            text-align: center;
            padding: 20px;
        }

        .qr-code img {
            max-width: 250px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .qr-code p {
            margin-top: 15px;
            color: #666;
            font-size: 0.9em;
        }

        .groups-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .group-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .group-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .group-card:hover::before {
            transform: scaleX(1);
        }

        .group-card.active {
            border-left-color: #4CAF50;
            background: #e8f5e8;
        }

        .group-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .group-name {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            font-size: 1.1em;
        }

        .group-info {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .group-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        input:checked + .slider {
            background-color: #4CAF50;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .words-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            min-height: 50px;
        }

        .word-tag {
            background: linear-gradient(45deg, #e9ecef, #f8f9fa);
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            font-size: 14px;
            border: 1px solid #dee2e6;
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .word-tag:hover {
            background: linear-gradient(45deg, #ffc107, #ffb300);
            transform: scale(1.05);
        }

        .word-tag .remove-word {
            margin-left: 8px;
            cursor: pointer;
            color: #dc3545;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .word-tag .remove-word:hover {
            background: #dc3545;
            color: white;
        }

        .add-word-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .add-word-form input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #eee;
            border-radius: 25px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            outline: none;
        }

        .add-word-form input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        .alert {
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-weight: bold;
            position: relative;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-left: 4px solid #28a745;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-left: 4px solid #dc3545;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            margin-bottom: 25px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 15px 10px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .tab::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .tab.active::before {
            transform: scaleX(1);
        }

        .tab-content {
            display: none;
            animation: fadeInTab 0.5s ease;
        }

        @keyframes fadeInTab {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-content.active {
            display: block;
        }

        .commands-list {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            border-left: 4px solid #667eea;
        }

        .commands-list strong {
            color: #667eea;
            display: block;
            margin: 15px 0 8px 0;
        }

        .maintenance-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .maintenance-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .maintenance-card h4 {
            color: #333;
            margin-bottom: 10px;
        }

        .maintenance-card p {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty-state .emoji {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .groups-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                padding: 12px;
            }

            .maintenance-actions {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .add-word-form {
                flex-direction: column;
            }

            .group-status {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 Painel Bot WhatsApp Admin</h1>
            <p>Gerencie seu bot administrador de grupos com facilidade</p>
        </div>

        <!-- Status da Conexão -->
        <div class="status-card">
            <h3>📡 Status da Conexão</h3>
            <div id="connection-status" style="margin: 20px 0;">
                <span class="status-indicator status-disconnected"></span>
                <span id="status-text">Desconectado</span>
            </div>
            <div id="connection-buttons">
                <button class="btn" onclick="connectWhatsApp()">🔗 Conectar WhatsApp</button>
                <button class="btn btn-danger" onclick="disconnectWhatsApp()">🔌 Desconectar</button>
            </div>
            <div id="qr-container" class="qr-code hidden">
                <h4>📱 Escaneie o QR Code no seu WhatsApp:</h4>
                <img id="qr-image" src="" alt="QR Code">
                <p><strong>Como conectar:</strong><br>
                WhatsApp → Menu → Dispositivos Conectados → Conectar Dispositivo</p>
            </div>
        </div>

        <!-- Navegação por Abas -->
        <div class="tabs">
            <button class="tab active" onclick="showTab(event, 'dashboard')">📊 Dashboard</button>
            <button class="tab" onclick="showTab(event, 'groups')">👥 Grupos</button>
            <button class="tab" onclick="showTab(event, 'words')">🚫 Palavras</button>
            <button class="tab" onclick="showTab(event, 'settings')">⚙️ Configurações</button>
        </div>

        <!-- Aba Dashboard -->
        <div id="dashboard" class="tab-content active">
            <div class="card">
                <h3>📈 Estatísticas Gerais</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="stat-active-groups">0</div>
                        <div class="stat-label">Grupos Ativos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="stat-total-groups">0</div>
                        <div class="stat-label">Total de Grupos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="stat-interactions">0</div>
                        <div class="stat-label">Total Interações</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="stat-warnings">0</div>
                        <div class="stat-label">Avisos Dados</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>ℹ️ Sobre o Bot</h3>
                <p>Este bot administrador oferece moderação inteligente para seus grupos do WhatsApp. Ele monitora mensagens, detecta palavras ofensivas, cria rankings divertidos e muito mais!</p>
                <br>
                <p><strong>🎯 Recursos principais:</strong></p>
                <ul style="margin: 10px 0 0 20px; line-height: 1.6;">
                    <li>Moderação automática de palavrões e links</li>
                    <li>Sistema de 3 avisos + "chibata de boi" 🐂</li>
                    <li>Rankings dos usuários mais ativos</li>
                    <li>Detecção de quem fica "de tocaia"</li>
                    <li>Criação automática de figurinhas</li>
                    <li>Controle seletivo por grupo</li>
                </ul>
            </div>
        </div>

        <!-- Aba Grupos -->
        <div id="groups" class="tab-content">
            <div class="card">
                <h3>👥 Gerenciar Grupos</h3>
                <p>Selecione em quais grupos o bot deve estar ativo. O bot só irá moderar e responder nos grupos marcados como ativos.</p>
                <div id="groups-loading" class="loading">
                    Carregando grupos...
                </div>
                <div id="groups-container" class="groups-grid hidden">
                    <!-- Grupos serão carregados aqui -->
                </div>
                <div id="no-groups" class="empty-state hidden">
                    <span class="emoji">📱</span>
                    <h3>Nenhum grupo encontrado</h3>
                    <p>Conecte seu WhatsApp primeiro para ver os grupos disponíveis.</p>
                </div>
            </div>
        </div>

        <!-- Aba Palavras -->
        <div id="words" class="tab-content">
            <div class="card">
                <h3>🚫 Gerenciar Palavras Ofensivas</h3>
                <p>Configure as palavras que o bot deve moderar automaticamente. O sistema não diferencia maiúsculas de minúsculas.</p>
                
                <div class="add-word-form">
                    <input type="text" id="new-word" placeholder="Digite uma palavra ofensiva..." 
                           onkeypress="handleWordKeyPress(event)">
                    <button class="btn" onclick="addOffensiveWord()">➕ Adicionar</button>
                </div>

                <div id="words-container" class="words-container">
                    <!-- Palavras serão carregadas aqui -->
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-success" onclick="saveOffensiveWords()">💾 Salvar Alterações</button>
                </div>
            </div>
        </div>

        <!-- Aba Configurações -->
        <div id="settings" class="tab-content">
            <div class="card">
                <h3>🗑️ Manutenção de Dados</h3>
                <p>Gerencie os dados armazenados pelo bot para otimizar o desempenho:</p>
                
                <div class="maintenance-actions">
                    <div class="maintenance-card">
                        <h4>🔄 Interações</h4>
                        <p>Remove o histórico de mensagens dos usuários (afeta rankings)</p>
                        <button class="btn btn-warning" onclick="clearData('interactions')">Limpar Interações</button>
                    </div>
                    
                    <div class="maintenance-card">
                        <h4>⚠️ Avisos</h4>
                        <p>Remove todos os avisos dados aos usuários</p>
                        <button class="btn btn-warning" onclick="clearData('warnings')">Limpar Avisos</button>
                    </div>
                    
                    <div class="maintenance-card">
                        <h4>🗑️ Tudo</h4>
                        <p>Remove todos os dados (interações + avisos)</p>
                        <button class="btn btn-danger" onclick="clearData('all')">Limpar Tudo</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>📋 Comandos Disponíveis</h3>
                <p>Lista completa de comandos que funcionam no WhatsApp:</p>
                
                <div class="commands-list">
                    <strong>👥 Comandos para usuários:</strong>
                    !ranking - Ver ranking dos mais ativos do grupo<br>
                    !tocaia - Ver quem fica só observando<br>
                    !ajuda - Mostrar menu completo de ajuda<br>

                    <strong>👑 Comandos para administradores:</strong>
                    !limpar @usuario - Limpar avisos de um usuário específico<br>

                    <strong>🎨 Recursos automáticos:</strong>
                    • Enviar imagem + palavra "figurinha" = Cria sticker<br>
                    • Moderação automática de palavrões e links<br>
                    • Sistema de 3 avisos + chibata virtual 🐂💢<br>
                    • Contagem automática de interações<br>

                    <strong>⚙️ Como ativar em um grupo:</strong>
                    Use este painel para selecionar os grupos ativos<br>
                    Ou use o comando !ativar (se implementado)
                </div>
            </div>

            <div class="card">
                <h3>ℹ️ Informações do Sistema</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <strong>🔧 Versão</strong><br>
                        Bot WhatsApp Admin v1.0
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <strong>📡 Baileys</strong><br>
                        v6.6.0
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <strong>🌐 Painel</strong><br>
                        http://localhost:3000
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                        <strong>💾 Dados</strong><br>
                        Salvos em bot_data.json
                    </div>
                </div>
            </div>
        </div>

        <!-- Container de Alertas -->
        <div id="alert-container"></div>
    </div>

    <script>
        const socket = io();
        let currentGroups = [];
        let offensiveWords = [];

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            loadGroups();
            loadOffensiveWords();
        });

        // Socket.IO Events
        socket.on('statusUpdate', function(data) {
            updateConnectionStatus(data);
        });

        socket.on('groupsUpdate', function() {
            loadGroups();
            loadStats();
        });

        socket.on('statsUpdate', function() {
            loadStats();
        });

        // Navegação por abas
        function showTab(event, tabName) {
            // Remove active de todas as abas
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Ativa a aba selecionada
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            // Carrega dados específicos da aba
            if (tabName === 'groups') loadGroups();
            if (tabName === 'words') loadOffensiveWords();
            if (tabName === 'dashboard') loadStats();
        }

        // Atualiza status da conexão
        function updateConnectionStatus(data) {
            const statusElement = document.getElementById('connection-status');
            const statusText = document.getElementById('status-text');
            const qrContainer = document.getElementById('qr-container');
            const qrImage = document.getElementById('qr-image');
            
            // Remove todas as classes de status
            const indicator = statusElement.querySelector('.status-indicator');
            indicator.className = 'status-indicator';
            
            switch (data.status) {
                case 'connected':
                    indicator.classList.add('status-connected');
                    statusText.innerHTML = '✅ <strong>Conectado e funcionando!</strong>';
                    qrContainer.classList.add('hidden');
                    break;
                case 'qr':
                    indicator.classList.add('status-qr');
                    statusText.innerHTML = '📱 <strong>Aguardando leitura do QR Code</strong>';
                    if (data.qrCode) {
                        qrImage.src = data.qrCode;
                        qrContainer.classList.remove('hidden');
                    }
                    break;
                case 'disconnected':
                    indicator.classList.add('status-disconnected');
                    statusText.innerHTML = '❌ <strong>Desconectado</strong>';
                    qrContainer.classList.add('hidden');
                    break;
                case 'error':
                    indicator.classList.add('status-disconnected');
                    statusText.innerHTML = '⚠️ <strong>Erro na conexão</strong>';
                    qrContainer.classList.add('hidden');
                    if (data.error) {
                        showAlert('Erro: ' + data.error, 'error');
                    }
                    break;
            }
        }

        // Conectar WhatsApp
        async function connectWhatsApp() {
            try {
                showAlert('Iniciando conexão...', 'success');
                const response = await fetch('/api/connect', { 
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();
                if (data.success) {
                    showAlert(data.message, 'success');
                } else {
                    showAlert('Erro ao conectar: ' + data.message, 'error');
                }
            } catch (error) {
                showAlert('Erro ao conectar: ' + error.message, 'error');
            }
        }

        // Desconectar WhatsApp
        async function disconnectWhatsApp() {
            if (!confirm('Tem certeza que deseja desconectar o WhatsApp?')) return;
            
            try {
                const response = await fetch('/api/disconnect', { 
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();
                showAlert(data.message, 'success');
            } catch (error) {
                showAlert('Erro ao desconectar: ' + error.message, 'error');
            }
        }

        // Carregar estatísticas
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();
                
                // Anima os números
                animateNumber('stat-active-groups', stats.activeGroups);
                animateNumber('stat-total-groups', stats.totalGroups);
                animateNumber('stat-interactions', stats.totalInteractions);
                animateNumber('stat-warnings', stats.totalWarnings);
            } catch (error) {
                console.error('Erro ao carregar stats:', error);
            }
        }

        // Animar números das estatísticas
        function animateNumber(elementId, targetValue) {
            const element = document.getElementById(elementId);
            const currentValue = parseInt(element.textContent) || 0;
            const increment = targetValue > currentValue ? 1 : -1;
            const speed = Math.abs(targetValue - currentValue) > 100 ? 10 : 50;

            let current = currentValue;
            const timer = setInterval(() => {
                current += increment;
                element.textContent = current;
                
                if ((increment > 0 && current >= targetValue) || 
                    (increment < 0 && current <= targetValue)) {
                    element.textContent = targetValue;
                    clearInterval(timer);
                }
            }, speed);
        }

        // Carregar grupos
        async function loadGroups() {
            try {
                const response = await fetch('/api/groups');
                const groups = await response.json();
                currentGroups = groups;
                
                const container = document.getElementById('groups-container');
                const loading = document.getElementById('groups-loading');
                const noGroups = document.getElementById('no-groups');
                
                if (groups.length === 0) {
                    loading.classList.add('hidden');
                    container.classList.add('hidden');
                    noGroups.classList.remove('hidden');
                    return;
                }
                
                container.innerHTML = '';
                groups.forEach(group => {
                    const groupCard = createGroupCard(group);
                    container.appendChild(groupCard);
                });
                
                loading.classList.add('hidden');
                noGroups.classList.add('hidden');
                container.classList.remove('hidden');
            } catch (error) {
                console.error('Erro ao carregar grupos:', error);
                document.getElementById('groups-loading').innerHTML = '❌ Erro ao carregar grupos';
            }
        }

        // Criar card de grupo
        function createGroupCard(group) {
            const card = document.createElement('div');
            card.className = `group-card ${group.active ? 'active' : ''}`;
            
            // Trunca nome muito longo
            const groupName = group.name.length > 30 ? 
                group.name.substring(0, 30) + '...' : group.name;
            
            card.innerHTML = `
                <div class="group-name" title="${group.name}">${groupName}</div>
                <div class="group-info">
                    👥 ${group.participants} participante${group.participants !== 1 ? 's' : ''}<br>
                    📱 ID: ${group.id.split('@')[0]}
                </div>
                <div class="group-status">
                    <label class="toggle-switch">
                        <input type="checkbox" ${group.active ? 'checked' : ''} 
                               onchange="toggleGroup('${group.id}', this.checked)">
                        <span class="slider"></span>
                    </label>
                    <span style="font-weight: bold; color: ${group.active ? '#4CAF50' : '#999'};">
                        ${group.active ? '✅ Ativo' : '❌ Inativo'}
                    </span>
                </div>
            `;
            
            return card;
        }

        // Toggle grupo ativo/inativo
        async function toggleGroup(groupId, active) {
            try {
                const response = await fetch(`/api/groups/${encodeURIComponent(groupId)}/toggle`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ active })
                });
                
                const data = await response.json();
                if (data.success) {
                    showAlert(data.message, 'success');
                    setTimeout(() => {
                        loadGroups();
                        loadStats();
                    }, 500);
                } else {
                    showAlert('Erro: ' + data.message, 'error');
                    loadGroups(); // Reverte a mudança visual
                }
            } catch (error) {
                showAlert('Erro ao alterar grupo: ' + error.message, 'error');
                loadGroups(); // Reverte a mudança visual
            }
        }

        // Carregar palavras ofensivas
        async function loadOffensiveWords() {
            try {
                const response = await fetch('/api/offensive-words');
                const data = await response.json();
                offensiveWords = data.words || [];
                renderOffensiveWords();
            } catch (error) {
                console.error('Erro ao carregar palavras:', error);
                showAlert('Erro ao carregar palavras ofensivas', 'error');
            }
        }

        // Renderizar palavras ofensivas
        function renderOffensiveWords() {
            const container = document.getElementById('words-container');
            container.innerHTML = '';
            
            if (offensiveWords.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <span class="emoji">📝</span>
                        <p>Nenhuma palavra ofensiva cadastrada.</p>
                        <p>Adicione palavras que o bot deve moderar.</p>
                    </div>
                `;
                return;
            }
            
            offensiveWords.forEach((word, index) => {
                const wordTag = document.createElement('div');
                wordTag.className = 'word-tag';
                wordTag.innerHTML = `
                    ${word}
                    <span class="remove-word" onclick="removeOffensiveWord(${index})" title="Remover palavra">✖</span>
                `;
                container.appendChild(wordTag);
            });
        }

        // Adicionar palavra ofensiva
        function addOffensiveWord() {
            const input = document.getElementById('new-word');
            const word = input.value.trim().toLowerCase();
            
            if (!word) {
                showAlert('Digite uma palavra primeiro!', 'error');
                return;
            }
            
            if (word.length < 2) {
                showAlert('A palavra deve ter pelo menos 2 caracteres!', 'error');
                return;
            }
            
            if (offensiveWords.includes(word)) {
                showAlert('Esta palavra já está na lista!', 'error');
                input.value = '';
                return;
            }
            
            offensiveWords.push(word);
            input.value = '';
            renderOffensiveWords();
            showAlert('Palavra adicionada! Não esqueça de clicar em "Salvar".', 'success');
        }

        // Remover palavra ofensiva
        function removeOffensiveWord(index) {
            if (confirm('Tem certeza que deseja remover esta palavra?')) {
                const removedWord = offensiveWords[index];
                offensiveWords.splice(index, 1);
                renderOffensiveWords();
                showAlert(`"${removedWord}" removida! Clique em "Salvar" para confirmar.`, 'success');
            }
        }

        // Salvar palavras ofensivas
        async function saveOffensiveWords() {
            try {
                const response = await fetch('/api/offensive-words', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ words: offensiveWords })
                });
                
                const data = await response.json();
                if (data.success) {
                    showAlert(data.message, 'success');
                } else {
                    showAlert('Erro ao salvar: ' + data.message, 'error');
                }
            } catch (error) {
                showAlert('Erro ao salvar palavras: ' + error.message, 'error');
            }
        }

        // Handle Enter key na entrada de palavras
        function handleWordKeyPress(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                addOffensiveWord();
            }
        }

        // Limpar dados
        async function clearData(type) {
            const messages = {
                'interactions': 'Tem certeza que deseja limpar todas as interações dos usuários?\n\nIsso irá resetar todos os rankings!',
                'warnings': 'Tem certeza que deseja limpar todos os avisos dados aos usuários?\n\nTodos voltarão ao "status limpo".',
                'all': '⚠️ ATENÇÃO: Isso vai limpar TODOS os dados!\n\n- Rankings (interações)\n- Avisos de usuários\n\nEsta ação não pode ser desfeita!'
            };
            
            if (!confirm(messages[type])) return;
            
            // Confirmação adicional para limpeza completa
            if (type === 'all' && !confirm('Última chance! Confirma que quer limpar TUDO?')) return;
            
            try {
                const response = await fetch('/api/clear-data', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type })
                });
                
                const data = await response.json();
                if (data.success) {
                    showAlert(data.message, 'success');
                    loadStats();
                } else {
                    showAlert('Erro ao limpar dados: ' + data.message, 'error');
                }
            } catch (error) {
                showAlert('Erro ao limpar dados: ' + error.message, 'error');
            }
        }

        // Mostrar alertas
        function showAlert(message, type) {
            const container = document.getElementById('alert-container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type === 'error' ? 'error' : 'success'}`;
            alert.innerHTML = `
                <strong>${type === 'error' ? '❌ Erro:' : '✅ Sucesso:'}</strong> ${message}
            `;
            
            container.appendChild(alert);
            
            // Remove automaticamente após 5 segundos
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.style.animation = 'slideUp 0.3s ease forwards';
                    setTimeout(() => alert.remove(), 300);
                }
            }, 5000);
            
            // Permite remover clicando
            alert.addEventListener('click', () => {
                alert.style.animation = 'slideUp 0.3s ease forwards';
                setTimeout(() => alert.remove(), 300);
            });
        }

        // Atualização automática das estatísticas a cada 30 segundos
        setInterval(() => {
            if (document.getElementById('dashboard').classList.contains('active')) {
                loadStats();
            }
        }, 30000);

        // Adiciona estilo para animação de saída dos alertas
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideUp {
                from { opacity: 1; transform: translateY(0); }
                to { opacity: 0; transform: translateY(-20px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
                        '
